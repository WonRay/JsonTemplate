# jsontemplate
## What is JsonTemplate?
JsonTemplate is a tool for creating json strings in a simpler way.

## What can JsonTemplate do?
Suppose that we want to create following json:
```json
{
  "name" : "John",
  "age" : 23,
  "role" : [ "developer", "tester" ],
  "address" : {
    "city" : "Utrecht",
    "street" : "Musicallaan",
    "number" : 413
  }  
}
```

The most classical way in Java:
```java
String json = "{" +
              "  \"name\" : \"John\"," +
              "  \"age\" : 23," +
              "  \"role\" : [ \"developer\", \"tester\" ]," +
              "  \"address\" : {" +
              "    \"city\" : \"Utrecht\"," +
              "    \"street\" : \"Musicallaan\"," +
              "    \"number\" : 413" +
              "  }" +
              "}";
```
Or by using object serializers
1. create object `Person`
1. create object `Address`
1. set each value
1. use library such as Jackson to serialize it

With JsonTemplate, you can achiev it with the following code:
```java
String template = "{" +
                  "  name : John," +
                  "  age : 23," +
                  "  role : [ developer, tester ]," +
                  "  address : {" +
                  "    city : Utrecht," +
                  "    street : Musicallaan," +
                  "    number : 413" +
                  "  }" +
                  "}";
String json = new JsonTemplate(template).prettyString();                      
``` 
Much cleaner! No supporting classes needed.

Suppose that what matters in your program is the schema instead of the specific values 
in the json. For example, you need to test the validation logic in the controllers.
JsonTemplate supports you to specify only the schema and generates a schema compatible
json for you. The above example can be coded in the following way:

```java
String template = "{" +
                  "  name : @s," +
                  "  age : @i(max=100)," +
                  "  role : @s[](max=3)," +
                  "  address : {" +
                  "    city : @s," +
                  "    street : @s," +
                  "    number : @i" +
                  "  }" +
                  "}";
String json = new JsonTemplate(template).prettyString();                      
``` 

## Example
### Value producers
<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
{
  aField : @s
}
</pre></td><td><pre>
{
  "aField" : "ISCZd"
}
</pre></td></tr>
<tr><td><pre>
{
  aField : @i
}
</pre></td><td><pre>
{
  "aField" : 56
}
</pre></td></tr>
<tr><td><pre>
{
  aField : @b
}
</pre></td><td><pre>
{
  "aField" : false
}
</pre></td></tr>
</table>

In JsonTemplate, **@x** is the **type name**. When it is at the value part,
it represents a value with that type. In the above examples, `@s`, `@i`, `@b` 
are **value producers** which produces values with types of string, integer, 
and boolean respectively. If no parameter is given to a value producer, it generates 
a random value by default.


### Value producers with a single parameter
<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
{
  aField : @s(myValue)
}
</pre></td><td><pre>
{
  "aField" : "myValue"
}
</pre></td></tr>
</table>

If a **single parameter** is given to a value producer, a fixed value which is 
equal to the single parameter is generated by default.

### Value producers with a list parameter
<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
{
  aField : @s(A, B, C, D)
}
</pre></td><td><pre>
{
  "aField" : "C"
}
</pre></td></tr>
</table>

If a **list parameter** is given to a value producer, a value in that list is
randomly picked up by the value producer by default.

### Value producers with a map parameter
<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
{
  aField : @s(size=10)
}
</pre></td><td><pre>
{
  "aField" : "awpVXpJTxb"
}
</pre></td></tr>
<tr><td><pre>
{
  aField : @s(min=10, max=20)
}
</pre></td><td><pre>
{
  "aField" : "awpVXpJTxb"
}
</pre></td></tr>
</table>

If a **map parameter** is given to a value producer, a value is genereated
according to the map values. Following is the default expected map values: ??
reference

### Json objects
<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
{
  anObject : {
    aField : @s, 
    bField : @s
  }
}
</pre></td><td><pre>
{
  "anObject" : {
    "aField" : "hhnNc",
    "bField" : "EyHbB"
  }
}
</pre></td></tr>
</table>

A json object consists of a set of properties. Each property can be specified
with a value producer.

### Array producer with size configuration
<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
@s[](3)
</pre></td><td><pre>
[ "hwhCL", "tDcPO", "OgdGC" ]
</pre></td></tr>
<tr><td><pre>
@s[](1, 10)
</pre></td><td><pre>
[ "QwWxg", "ytaGY", "NGZBr", "DsBKx", "MvwSb", "qsEXA", "YHkxC" ]
</pre></td></tr>
</table>

Array tag **[]** produces an array. The default value producer for the array 
elements is placed before `[]`. The size configuration of the generated array is 
placed after `[]`. 

- `(3)` means size of 3 and it is a shorthand of `(size=3)`
- `(1, 10)` means the size range is between 1 and 10 and it is a short hand of
`(min=1, max=10)`
- `(min=1)` means the minimum size is 1, by default the maximum size is 2 times
greater than the minimum value which is 2 in this case. There is no shorthand.
- `(max=10)` means the maximem size is 10, by default the minimum size is 0.
There is no shorthand.


### Array producer with elements
<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
@s [ 1, 2, 3, 4 ]
</pre></td><td><pre>
[ "1", "2", "3", "4" ]
</pre></td></tr>
<tr><td><pre>
@s [ 1, 2, 3, 4 ](6)
</pre></td><td><pre>
[ "1", "2", "3", "4", "qRTWm", "RTBik" ]
</pre></td></tr>
<tr><td><pre>
@s [ 1, @i(2), @b(false), @s(4) ]
</pre></td><td><pre>
[ "1", 2, false, "4" ]
</pre></td></tr>
</table>

The array tag can contain elements. 

- In the first example, it produces string elements.
- In the second exmaple, the size is greater than the amount of the listed elements.
The extra elements will be filled by the value producer. In this case, the values
are random strings of length 5. If the size is not greater, all listed elements
are remained without filled elements. Same rule applies to the range size.
- In the third example, each elements can have its own value producer the it
overwrites the default value producer.


### Customized value producer definition
<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
{
  @address : {
    city : @s,
    street : @s,
    number : @i
  },
  office : @address, 
  home : @address
}
</pre></td><td><pre>
{
  "office" : {
    "city" : "MavBr",
    "street" : "odcjd",
    "number" : 79
  },
  "home" : {
    "city" : "zdNCm",
    "street" : "UsBcv",
    "number" : 63
  }
}
</pre></td></tr>
<tr><td><pre>
{ 
  @address : {
    city : @s(Amsterdam, Utrecht),
    street : @s,
    number : @i(min=1000)
  },
  office : @address,
  home : @address
}
</pre></td><td><pre>
{
  "office" : {
    "city" : "Amsterdam",
    "street" : "LAUbf",
    "number" : 1626
  },
  "home" : {
    "city" : "Utrecht",
    "street" : "xpLYB",
    "number" : 1024
  }
}
</pre></td></tr>
</table>

A value producer can be defined in the template. It is in the form of a json object
property and the property name should start with the type tag **@**. 

- The definition is always global.
- The definition is taken out from where it is defined.
- An instance of the definition is put to the places where the definition is referred.

### Other pre-installed types
<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
{
  ipField : @ip
}
</pre></td><td><pre>
{
  "ipField" : "59.221.49.83"
}
</pre></td></tr>
</table>

### Default type
<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
@s {
  fieldA, 
  fieldB
}
</pre></td><td><pre>
{
  "fieldA" : "yUiIE",
  "fieldB" : "vrMwv"
}
</pre></td><td><pre>
@s(size=10) {
  fieldA, 
  fieldB : @s(size=20)
}
</pre></td><td><pre>
{
  "fieldA" : "yUiIE",
  "fieldB" : "vrMwv" // todo
}
</pre></td></tr>
</table>

In the example of the array producer, we have seen the usage of the default type. 
Actually, the default type can be also applied to json object. In the first example,
the object properties have only names and the property values are omitted. In this
case, the information about how the value is generated will be retrieved from its
parent. This "looking-up-type" process can be performed recursively till the root.
Each element can overwrite the default value producer passed from its parent. 

## Inject variables
### Use the variable indicator in value specification
```java
  new JsonTemplate().withVar("name", "John")
```
<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
{
  name : $name
}
</pre></td><td><pre>
{
  "name" : "John"
}
</pre></td></tr>
</table>

The above example shows how to inject a variable into template. Token `$` is a
 variable indicator. `JsomTemplate` provies `withVar(String, Object)` and 
 `withVars(Map<String, Object>)` to associating variables with the template. 

```java
  new JsonTemplate().withVar("letters", new String[]{"A", "B", "C"})
```
<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
{
  letters : $letters
}
</pre></td><td><pre>
{
  "letters" : [ "A", "B", "C" ]
}
</pre></td></tr>
</table>

If the variable is an array or has type of `Colleciton`, it is transformed to a 
json array.

```java
  Map<String, Object> person = new HashMap<>();
  person.put("name", "Haihan");
  person.put("age", 33);
  person.put("male", true);
  person.put("languages", Arrays.asList("Chinese", "English", "Dutch"));
  new JsonTemplate().withVar("person", person)
```
<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
{
  person : $person
}
</pre></td><td><pre>
{
  "person" : {
    "languages" : [ "Chinese", "English", "Dutch" ],
    "name" : "Haihan",
    "age" : 33,
    "male" : true
  }
}
</pre></td></tr>
</table>

If the variable has type of `Map`, it is transformed to a json object.

### Use the variable indicator in type specification
<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
{
  aField: @s($myValue)
}
</pre></td><td><pre>
{
  "aField" : "helloworld"
}
</pre></td></tr>
</table>


<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
{
  aField: @s($myValue)
}
</pre></td><td><pre>
{
  "aField" : "C"
}
</pre></td></tr>
</table>


<table><tr><th width="600">Template</th><th width="50%">Generated Json</th></tr>
<tr><td><pre>
{
  aField: @s($config)
}
</pre></td><td><pre>
{
  "aField" : "HORklISFDrQzhumRojWQ"
}
</pre></td></tr>
</table>

## Combination with other libraries
 ### use String.format()
 ```java
  String template = String.format("@s { a:%s, b:@s }", "valueA");
  new JsonTemplate(tempalte).compactString();
 ```
 
```json

```

jsonpath

javafaker

- @s (String)
-- size
-- min
-- max


- @i (Integer)

